# PLC Code-Level Vulnerabilities

https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=8460287


II. PLC OVERVIEW 这一段介绍了可编程逻辑控制器（PLC）的概况，具体内容包括：

1. **PLC的定义**：PLC是嵌入式设备家族的一部分，除了硬件架构外，它们还有自己的操作系统。

2. **软件方面的关注点**：文章强调了PLC软件方面的重要性，因为它通常是最容易受到网络攻击的部分。

3. **PLC软件组成**：
   - **PLC操作系统**：PLC提供ICS/SCADA系统的主要控制，是实时系统，负责与所有输入（传感器状态或反馈、人机界面HMI、其他PLC和现场设备等）进行实时交互，并通过工业网络传输适当的输出或命令，执行PLC内的特定程序，梯形逻辑代码，在非常有限的时间内完成。
   - **梯形逻辑代码**：梯形逻辑是编写PLC程序代码的编程语言，使用特殊的编译器或软件编写。例如，RSLogix5000是一款用于编写、编辑和编译梯形逻辑代码的软件。该软件使用IEC 61131-3语言标准，这是一个开放的国际标准，用于PLC编程语言。

4. **梯形逻辑代码的特点**：
   - 梯形逻辑代码是控制、处理和监控所有参数、输入、输出和其他运行自动化或手动控制设备或系统所需的决策的程序。
   - 代码必须高度可靠，具有实时数据可用性和高完整性，以便及时做出准确和精确的逻辑调用和决策。
   - 与其他高级语言不同，梯形逻辑代码在PLC运行时随时可以访问和编辑，无需停止或重新启动整个PLC梯形逻辑程序。因此，任何代码漏洞都可能导致重大灾难性问题，即使外部环境是安全的。

5. **编程语言的多样性**：提到了不同的编程语言结构，如梯形逻辑图（图形化）、功能块图（FBD，图形化）和结构化文本（文本形式）。

6. **梯形逻辑的普及性**：梯形逻辑是上述代码结构中最受欢迎的，因为它控制着所有自动化或手动控制设备或系统的运行。

通过这一部分，文章为读者提供了PLC的基础知识，包括它们的硬件和软件组成，以及梯形逻辑代码在PLC中的重要性和作用。


LADDER LOGIC可能面临的安全威胁

III. LADDER LOGIC CODE VULNERABILITIES 这一节详细讨论了梯形逻辑代码中的漏洞和弱点，这些漏洞可能会被恶意攻击所利用。

文章指出，即使程序员遵循公司的标准和建议，结构不良和设计不当的梯形逻辑代码也会增加漏洞和安全风险。以下是文章中提到的一些主要的梯形逻辑代码漏洞和不良编程场景：

1. **使用重复指令**：在梯形逻辑代码中重复使用某些操作数（如OTE、计数器、定时器和JSR）会导致不希望的结果。

2. **窥探**：编写能够记录某些关键参数和值的梯形逻辑代码，以便在不影响逻辑流程和目的的情况下秘密泄露信息。

3. **缺少特定线圈或输出**：当梯形逻辑中缺少其他标签依赖的特定输出线圈时，会增加漏洞风险。

4. **绕过**：通过在线强制某些操作数的值或使用空分支、跳线来绕过逻辑。

5. **拒绝服务攻击（DoS）**：用户可以编写或上传恶意的梯形逻辑代码到PLC，该代码可能在特定时间激活或触发，导致PLC严重减慢、完全停止或造成重大故障。

6. **使用硬编码值**：在某些情况下，使用硬编码的值或参数可能会危及过程或其相关程序。

7. **竞争条件**：当两个代码或逻辑操作数相互竞争时，可能导致不一致的结果，并可能被用来创建威胁以损坏设备。

8. **缺乏详尽的诊断和报警消息**：如果没有详细和深入的报警、诊断或前提条件，设备可能会面临巨大风险。

9. **编译器警告**：忽视某些PLC编译器警告可能是严重的，因为它们可能是真正的威胁。

10. **未使用的标签或操作数**：未使用的标签可能被休眠的恶意代码或外部攻击利用。

11. **程序模式**：保持PLC在“程序模式”或“解锁模式”，允许他人有意或无意地上传错误的或恶意的梯形逻辑代码。

12. **缺乏身份验证**：在上传新的或修改过的梯形逻辑代码到PLC之前，没有进行身份验证。

文章还强调，许多公司和供应商错误地认为梯形逻辑是安全的，不会被黑客和入侵者访问，因为PLC网络通常是隔离的。然而，由于随机威胁、内部威胁和外部威胁，这种假设是不正确的。

最后，文章提供了针对上述漏洞的解决方案和建议，以减轻、减少或消除恶意攻击或威胁。


1. Using duplicated instructions

这段文字讨论了在梯形图逻辑代码中重复使用某些操作数（如 OTE（输出触发元件）、计数器、计时器和JSR（跳转子程序））可能导致的不良结果。文中以图4为例，展示了重复使用OTE操作数Y1的情况。这种重复逻辑会导致Y1在其非预期的时间被触发。原因是Y1在第一行梯形逻辑中被打开，如果X2被启用，它将立即关闭。因此，Y1的开关状态取决于它所属的梯形逻辑行的扫描结果。一个操作数的意外波动值会使调试或发现问题变得更加困难。

此外，文本还提到，某些PLC（可编程逻辑控制器）不允许重复某些输出，而其他一些PLC则允许这样做。这意味着不同的PLC系统对代码的重复使用有不同的限制和规则。


2. Snooping

这段文字讨论了一种被称为"窥探"（Snooping）的梯形图逻辑编程技巧，这种技巧可以被用来在不影响逻辑流程和目的的情况下，秘密地记录并泄露某些关键参数和值，用于间谍活动。文中提到，这可以通过使用数组指令来实现，例如FIFO（先进先出）和其他基于数组的指令，如“ADD ON”这样的用户定义指令。

这些指令可以被悄无声息地添加到代码中，并且不会引发任何可疑或不寻常的行为，从而使得这种窥探行为很难被检测到。这意味着，如果有人恶意地在PLC程序中嵌入了这样的代码，他们可以在不引起注意的情况下窃取敏感信息，这对系统的安全性构成了潜在的威胁。

3. Missing certain coils or outputs

这段文字讨论了在梯形图逻辑代码中缺少特定输出线圈（如OTEs、锁存器或设置、解锁等）时可能发生的问题。当其他标签（tag）依赖于这些缺失的输出线圈时，就会出现这种情况，如图5所示。缺少输出线圈会增加系统面临安全威胁的风险。这可能是一个警告信号，表明有人可能故意篡改逻辑，以改变某些关键值，从而使系统做出错误的调用和决策。

图6展示了正确处理OTE指令的方法，其中每一行都有其适当的前置条件和输出操作数。Y11是一个OTE指令，它依赖于通常开指令Y2的值。如果没有Y2指令作为Y11的前置条件（被删除或被替换为无用的假指令），那么Y11的行条件就会变为假（Y11始终关闭）。这种情况很难被注意到。

总之，这段文字强调了在梯形图逻辑编程中，确保所有必要的输出线圈都存在的重要性，以及缺少这些输出线圈可能带来的安全隐患和系统故障的风险。

4. Bypassing

这段文字讨论了梯形图逻辑编程中的"绕过"（Bypassing）问题。绕过可以通过两种方式实现：

1. **手动强制值**：在梯形图逻辑在线（即运行中）时，手动强制某些操作数的值。这意味着可以改变某些输入或输出的状态，而不需要通过正常的逻辑流程来实现。

2. **使用空分支、跳线**：通过在梯形图中使用空分支（即没有逻辑代码的分支）或跳线（允许绕过某些逻辑步骤直接跳转到其他部分），来绕过正常的逻辑流程。

如图7所示，这些方法可以用来绕过梯形图中的某些逻辑部分，这可能会导致安全漏洞，因为它们允许未经授权的访问或修改系统的行为，而不需要遵循正常的逻辑规则。

总的来说，这段文字强调了在梯形图逻辑编程中需要避免绕过正常逻辑流程的行为，因为这可能会带来安全风险和系统不稳定。

5. DoS

这段文字讨论了针对可编程逻辑控制器（PLC）的拒绝服务（DoS）攻击，这种攻击可以通过编写或上传恶意的梯形图逻辑代码来实现，这些代码可能在特定时间被激活或触发。这种攻击可能导致PLC严重减速、完全停止运行或引起重大故障。操作员可能无法访问梯形图逻辑、编辑它或实时监控值。

攻击可以通过以下方式实施：
- 通过JSR（跳转子程序）指令编码重复的SBR（子程序调用）。
- 通过跳线编码无限循环。
- 嵌套计时器和跳线。
- 不正确地插入MCR（主控复位）指令，这些指令会去激活非保持性指令，如OTE线圈。
- 编码可能导致致命错误或重大故障的梯形逻辑。这样的故障可能需要重启PLC或重新上传正确的梯形逻辑，导致数据丢失和与该PLC相关的整个自动化系统的临时关闭。恢复过程可能耗时且可能导致对精密工业活动或设备造成损害，以及关键参数或值的数据丢失。

解决这类问题的一个方案是使用计数器和计时器监控跳线和其他循环例程。如果循环次数超出预期，警告操作员并停止某些可疑的例程。

总的来说，这段文字强调了PLC面临的DoS攻击风险，并提出了一些预防措施，以减少这类攻击对工业系统的影响。

【这个应该是无法使用静态分析的方式解决的问题】

6. Using hard coded values

这段文字讨论了在某些情况下使用硬编码值或参数可能对过程或相关程序造成危害的问题。硬编码值是直接写入代码中的固定数值，与通过连续反馈动态生成的值相比，它们更容易被修改。修改可能是故意的、无意的，或者是恶意攻击的结果。

例如，程序员可能会无意中在数据库表中输入错误的值，而这些值在梯形图逻辑中是容易显示和访问的；或者通过在梯形图中切换指令的值来实现修改。这可能导致程序行为出现错误或异常。

为了解决这个问题，文中提到了一种解决方案，如图9所示，该方案可以保持源B的数值即使被无意中通过切换或通过更新PLC数据库表中的值而修改，也能保持更新。这意味着通过某种机制，可以确保数值的一致性和正确性，即使在数值被意外修改的情况下。

总的来说，这段文字强调了在编程时避免使用硬编码值的重要性，并提出了一种方法来确保数值的动态更新和准确性，从而提高系统的安全性和可靠性。

【这个应该也是无法通过静态分析解决的问题】

7. Racing

这段文字讨论了梯形图逻辑编程中出现的"竞争"（Racing）问题。当两个代码或逻辑操作数相互竞争时，可能导致不一致的结果，并可能被用来创建威胁，从而损坏设备。

竞争问题的一个例子是在同一代码或梯形图中的同一行中错误地放置操作数，例如计时器中的竞争场景。文中以图10为例，展示了如果将计时器（tmr1）的完成位（tmr1.DN）放在分支之前，当计时器的累加器达到预设值时，就会引起竞争问题（假设X1始终处于开启状态）。换句话说，每当计时器（tmr1）完成时，它将被重置，并且Valve01被激活，因为前置条件tmr1.DN为假。这可能导致Valve01永远不会关闭或被去激活。由于逻辑看起来是合法的，这将使得定位问题变得困难。

文中指出了正确的修正方法，如图11所示，这可能涉及到重新安排代码中操作数的顺序，以避免竞争问题。

总的来说，这段文字强调了在梯形图逻辑编程中避免竞争问题的重要性，并提供了一个具体的例子以及如何修正这种问题，以确保逻辑的正确执行和系统的稳定性。

【这个应该也是无法通过静态分析解决的问题】

8. Lack of thorough diagnostics and alarm messages

这段文字讨论了缺乏详尽的诊断和报警信息时可能带来的风险。当没有详细深入的报警、诊断或前置条件时，设备可能会面临很大的风险，因为操作员只能在损害发生后才注意到问题。这可能导致设备损坏或在恢复、调试或维护时出现时间延迟。

例如，如果在启用或运行电机时没有设置电机过载的报警或警告信息，可能会损坏电机，特别是如果物理过载开关受到破坏或不存在。如果受损的设备是关键设备，比如核反应堆，并且缺乏关键的报警或警告，问题将更加严重。

另一个问题是，当存在足够的报警和警告信息可以提示操作员，但它们被另一个错误或恶意的逻辑代码禁用，或者被能够访问代码的外部用户禁用时，问题也会加剧。

为了解决这些问题，文中提出了一些好的实践建议：
1. 在生产运行前，添加梯形图逻辑代码来模拟所有故障场景，并检查它们的状态是否活跃。
2. 创建一个心跳脉冲位——每50毫秒闪烁一次——与报警程序部分同步。

总的来说，这段文字强调了在自动化系统中实施详尽的诊断和报警机制的重要性，以帮助操作员及时发现并应对潜在的问题，从而减少设备损坏和生产中断的风险。

9. Unused tags or operands

这段文字讨论了在PLC（可编程逻辑控制器）编程中未使用的标签（tags）或操作数（operands）可能带来的安全风险。这些未使用的标签可能被休眠的恶意代码或外部攻击者利用，因为它们已经被预定义，使用它们进行操作可以悄无声息，不会引起任何警报或注意。许多PLC程序员在PLC数据库中留下未使用的标签。

恶意攻击者可能会在适当的时间和环境下触发信号，激活恶意输出，以中断或操纵数据。这可以通过使用某些指令（如计时器、跳线等）来实现，这些指令可能会过载PLC操作系统，减慢其速度，截断关键数据，或产生特定数据类型的故障和错误。

总的来说，这段文字强调了在PLC编程中清理和移除未使用的标签的重要性，以减少潜在的安全漏洞和攻击面。通过这样做，可以降低恶意软件或攻击者利用这些未使用资源来干扰或破坏系统的风险。

10. Program Mode

这段文字讨论了将PLC（可编程逻辑控制器）保持在“编程模式”或“解锁模式”可能带来的风险。在这种模式下，他人可能有意或无意地上传错误的或恶意的梯形图逻辑代码，从而危及整个自动化系统。用户甚至可能完全清除整个梯形图逻辑或上传任何可疑的代码。

保持PLC在“编程模式”还使PLC容易受到任何代码操纵的攻击，而无需删除或覆盖整个程序。它允许他人在梯形图逻辑运行时进行在线编辑（添加或删除代码片段或数据）。由于不需要对PLC进行关键的梯形图逻辑代码上传，任何用户都可能在不被注意的情况下进行这些操作，因为通常只有关键上传才会导致系统停止和重置。

总的来说，这段文字强调了不应该长时间将PLC保持在“编程模式”或“解锁模式”的重要性，以防止未经授权的代码上传和编辑，从而确保自动化系统的安全性和稳定性。

PLC允许用户在运行的时候编辑代码


11. The lack of authentication

这段文字讨论了在向PLC（可编程逻辑控制器）上传新的或修改过的梯形图逻辑代码时缺乏身份验证的问题。由于没有进行身份验证，攻击者可能会利用这一点上传恶意代码、有漏洞的代码或不当的代码，甚至可能破坏PLC。

为了避免这种情况，文中建议使用软件，比如比较工具，来确保关键代码片段的完整性。通过将它们与原始程序进行比较，可以验证上传的代码是否正确无误。

总的来说，这段文字强调了在上传代码到PLC之前进行身份验证的重要性，以及使用适当的软件工具来确保代码的安全性和正确性，从而保护PLC免受攻击和损害。

