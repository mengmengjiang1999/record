# OpenPLC: An IEC 61,131–3 compliant open source industrial controller for cyber security research
https://www.sciencedirect.com/science/article/pii/S0167404818305388

设计上与v1的有所不同，但是总之目前看不懂。虽然总的来说不是特别懂，但是实验部分明显升级了很多。

v1版本只评估了跟PLC的差异，这一版本增加了对攻击的防御能力。

另外还有跟输出输出模块的交流效率、scan time等问题。

5.1. Scan time test

在"5.1. Scan time test"（扫描时间测试）这一部分，文章描述了对PLC进行扫描时间测试的实验内容。以下是实验的主要内容：

1. **测试目的**：扫描时间测试的目的是评估PLC的实时性能。PLC作为实时系统，必须在有限的时间内对输入条件产生输出结果，否则可能会发生意外操作。

2. **测试程序**：为了测量扫描时间，实验中使用了包含单个梯形逻辑线（一个输入和一个输出）的简单程序。该程序基于输入的状态切换输出，如果输入为假，则输出为真；反之，如果输入为真，则输出为假。

3. **测试设置**：通过将PLC的输出和输入物理连接在一起，可以创建一个振荡器，该振荡器以PLC软件生成的方波信号的最高频率输出。

4. **扫描时间定义**：扫描时间定义为PLC读取所有输入、执行逻辑程序并回写所有输出所需的时间。在实验中，扫描时间通过测量方波信号的频率来确定，使用公式 \( \text{scan time} = \frac{1}{2 \times f} \)，其中 \( f \) 是方波信号的频率（赫兹）。

5. **测试执行**：将测试程序上传到每台被测试的PLC中，并使用供应商提供的编程软件将扫描时间设置为最小可用选项。然后，输入和输出被物理连接，以创建振荡器。

6. **数据收集**：使用微控制器测量输出切换时间，收集了每台PLC的4000个样本数据。

7. **结果分析**：通过收集的数据，可以确定PLC的扫描时间，这反映了系统响应时间。硬件能力、I/O数量、操作系统复杂性以及梯形逻辑解释器/编译器的实现都会影响扫描时间。

8. **测试结果**：文章列出了不同PLC的扫描时间测试结果，包括平均扫描时间和标准偏差。这些指标显示了系统的响应时间和保持实时响应的能力。

扫描时间测试是验证PLC性能的重要步骤，它帮助研究者了解在实际应用中PLC处理输入和产生输出的时间效率。通过这个测试，可以评估PLC是否适合对实时性要求较高的工业控制应用。


在"5.2. PLC ladder logic execution test"（5.2 PLC梯形逻辑执行测试）这一部分，文章描述了用于验证PLC执行梯形逻辑的准确性的测试。以下是实验的主要内容：

1. **测试目的**：此测试的目的是验证PLC根据IEC 61131-3标准正确执行梯形图逻辑。

2. **IEC 61131-3标准**：IEC 61131-3定义了所有PLC编程语言通用的标准功能块，包括双稳态元素、边缘检测、计时器、计数器和比较器，以及算术运算。

3. **测试程序**：测试程序利用了IEC 61131-3中定义的所有标准功能块，加上算术运算。测试程序被上传到每台PLC，并使用随机输入向量进行刺激。

4. **输入输出评估**：测试程序有4个离散输入和4个离散输出。每个输出负责评估IEC 61131-3中定义的特定功能块集合。

5. **功能块测试**：
   - **双稳态元素和边缘检测**：第一个输出（O1）测试双稳态元素和边缘检测。
   - **计时器**：第二个输出（O2）评估TON（接通延时）和TOF（断开延时）类型的计时器。
   - **计数器**：第三个输出（O3）验证CTU（上计数器）和CTD（下计数器）。
   - **算术和比较器**：第四个输出（O4）评估算术和比较器块。

6. **测试执行**：所有四个输入通过随机生成的100字节长的输入向量进行刺激，并通过微控制器连接到每台PLC，以提供输入向量刺激并读取PLC产生的四个输出。

7. **结果比较**：测试结果比较了不同PLC产生的输出向量，以验证它们是否能够根据相同的程序和输入向量生成相同的输出。

8. **测试结论**：文章根据测试结果得出结论，指出不同PLC在执行梯形逻辑时的一致性和差异性。

"5.2 PLC ladder logic execution test"部分为读者提供了一个评估PLC执行梯形逻辑准确性的测试框架，这对于确保PLC控制系统按预期工作至关重要。通过这种测试，研究人员可以验证PLC编程是否符合IEC 61131-3标准，并且能够在不同PLC之间实现预期的逻辑功能。


5.3. SCADA connectivity test

在"5.3. SCADA connectivity test"（5.3 SCADA连接性测试）这一部分，文章介绍了对PLC进行SCADA（监控控制与数据采集）系统连接性的测试。以下是实验的主要内容：

1. **测试目的**：测试的目的是评估PLC与SCADA系统的连接性，特别是验证不同PLC对Modbus协议的支持程度，因为Modbus是SCADA系统中广泛使用的协议。

2. **Modbus协议**：Modbus是一个请求/响应协议，定义了由功能代码指定的服务。Modbus功能代码分为公共、用户定义和保留三类。测试主要关注公共功能代码，因为它们被广泛记录且对所有符合Modbus规范的设备都是相同的。

3. **测试范围**：测试评估了Modbus公共功能代码在每个PLC上的实现情况，以及每种功能代码支持的地址范围。

4. **测试执行**：测试程序发送包含所有可能的Modbus公共功能代码的消息，并检查响应以确定特定功能代码是否被测试设备支持。同时，它还请求离散输入、线圈、输入寄存器和保持寄存器的数据，以评估每种数据类型支持的地址范围。

5. **测试结果**：测试结果显示了每个设备支持的功能代码列表以及每种数据类型支持的地址范围。

6. **观察结果**：
   - PLCs通常只关注与Modbus数据类型和诊断直接相关的公共功能的一个子集。
   - OpenPLC支持与其他测试设备相同的功能代码子集，除了诊断功能。由于OpenPLC是开源的，可以根据需要添加对诊断和其他功能代码的支持。
   - Modbus地址范围在每个供应商之间差异很大，一些设备为离散I/O提供更大的范围，而其他设备为寄存器提供更大的范围。
   - OpenPLC和Schneider将Modbus地址空间直接映射到物理I/O，这意味着物理输入和输出的更改可以直接从Modbus请求中观察到。

7. **特定PLC的观察**：
   - 为了进行测试，Omron PLC需要添加CP1W-MODTCP61扩展卡，因为该PLC没有内置以太网端口。该模块负责为Omron CP1L系列添加以太网和Modbus TCP功能。
   - Omron对不支持的功能代码没有实现Modbus规范中要求的无效功能代码异常，而是简单地关闭与请求者的连接，这给测试增加了难度，因为每次测试不支持的功能代码时都需要重置连接。

"5.3 SCADA connectivity test"部分为读者提供了一个评估不同PLC如何与SCADA系统通信的框架，特别是它们对Modbus协议的支持情况。这对于确保PLC能够与现有的SCADA系统集成并满足工业控制系统的需求至关重要。

5.4. Modbus injection attack test

在"5.4. Modbus injection attack test"（5.4 Modbus注入攻击测试）这一部分，文章讨论了针对PLC进行的一种特定类型的网络安全测试，即通过Modbus协议进行的注入攻击。以下是实验的主要内容：

1. **测试目的**：测试的目的是验证不同PLC在遭受Modbus注入攻击时的行为和响应。这种攻击可能会覆盖PLC寄存器中的关键控制参数，导致控制算法做出错误的决策。

2. **测试设置**：每台PLC被编程执行一个特定的梯形逻辑程序，该程序包含一个生成40毫秒周期方波的振荡器。振荡器的输出连接到一个内部计数器，计数器从0计数到100，然后自动重置。

3. **Modbus寄存器访问**：配置每台PLC，允许内部计数器的值通过Modbus保持寄存器（Holding Register）地址0访问。

4. **监控程序**：创建了一个监控程序，用于持续读取并记录每台PLC的Modbus保持寄存器0的值。

5. **注入攻击执行**：使用另一个程序执行注入攻击，该程序被设计为尽可能快地向目标PLC的Modbus保持寄存器0发送写消息，目的是覆盖内部计数器的值。

6. **攻击结果**：展示了对每台PLC进行攻击的结果。不同的PLC在攻击期间表现出不同的行为：
   - OpenPLC和Schneider PLC尽管能够被攻击多次覆盖计数值，但能够保持内部计数的正确性，输出值在正确内部计数和注入值99之间振荡。
   - Allen-Bradley PLC的行为不同，攻击实际上改变了内部计数值，导致计数器从注入值继续计数，输出值在99、100和0之间振荡。
   - Omron PLC由于其计数器与其他平台不同，测试使用了递减计数器，且在注入攻击期间未能处理许多读请求，导致读数点更稀疏。
   - Siemens PLC是唯一免疫于注入攻击的PLC，它将Modbus请求的优先级设置得低于梯形逻辑程序，并且会阻止发送消息过快的连接。

7. **OpenPLC的修改**：由于OpenPLC是开源的，因此可以修改其内部行为以匹配Siemens PLC在这种攻击下的最佳实践。通过在网络层和PLC逻辑之间添加仲裁器块，使Modbus写请求在临时缓冲区中等待，直到所有梯形逻辑对内部图像表的写操作完成，如果存在冲突，将保持PLC逻辑的值。

8. **修改后的测试**：在对OpenPLC进行修改后，重复执行了Modbus注入攻击测试。修改后的OpenPLC表现出与Siemens PLC相同的行为，注入消息不再有效，因为PLC逻辑优先于Modbus写请求。

"5.4 Modbus injection attack test"部分为读者提供了一个评估PLC在面对现实世界网络攻击时的脆弱性的框架，并且展示了开源PLC如何通过修改来提高其安全性和抵御特定攻击的能力。



在"6. Applications for cyber security"（6. 网络安全应用）这一部分，文章探讨了开源PLC平台OpenPLC在网络安全领域的潜在应用。以下是该部分的主要内容：

1. **ICS安全培训的易受攻击系统**：文章提出可以创建OpenPLC的一个分支，实现商业系统中的安全漏洞，用于进行工业控制系统（ICS）的安全培训、测试网络安全工具和练习常见的ICS渗透技术。

2. **嵌入式入侵检测系统（IDS）**：讨论了将IDS嵌入到PLC中的优势，包括减少网络暴露、提高准确性和训练时间，以及基于PLC执行的逻辑程序自动选择特征以进行学习。

3. **嵌入式加密**：文章提出通过在PLC中嵌入SSL、TLS或IPsec等加密技术，可以直接在设备中实现，无需额外硬件，从而提供与控制中心的安全通信通道，并减少网络延迟。

4. **OpenPLC的模块化架构**：强调了OpenPLC的模块化架构允许在不改变系统其他组件的情况下，对网络层架构进行修改。

5. **使用strongSwan进行的初步测试**：文章提到使用strongSwan与OpenPLC集成的初步测试显示出有希望的结果，strongSwan是一个完整的IPsec解决方案，提供服务器和客户端的加密和认证。

6. **实时性能**：文章还讨论了在OpenPLC中应用加密和机器学习算法时对实时性能的影响，并得出结论这些增强功能并未影响OpenPLC的实时特性。

"6. Applications for cyber security"部分为读者提供了OpenPLC在提升工业控制系统网络安全方面的多种潜在用途，展示了开源PLC如何为网络安全研究和实践提供灵活和强大的工具。