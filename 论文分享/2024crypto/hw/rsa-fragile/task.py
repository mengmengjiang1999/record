from Crypto.Util.number import *
from random import randint
from gmpy2 import *

flag = b'xxx'

def get_secretkeys():
    while True:
        m = 2 ** 3
        a = getRandomNBitInteger(128)
        b = getRandomNBitInteger(128)
        if a > b :
            continue
        if b > 2 * a:
            continue
        ra_ = randint(1000,10000)
        p_ = pow(a,m) + ra_
        p = next_prime(p_)
        ra = p - p_ + ra_
        rb_ = randint(1000, 10000)
        q_ = pow(b, m) + rb_
        q = next_prime(q_)
        rb = q - q_ + rb_
        
        if ra > 100000 or rb > 100000:
            continue
        if b > iroot(2 * pow(a, m) + ra, m)[0]:
            continue
        if ra > 2 * iroot(a,m//2)[0] or rb > 2 * iroot(b,m//2)[0]:
            continue
        break
    return p, ra, int(p).bit_length(), q, rb, int(q).bit_length()

p, ra, len_p, q, rb, len_q = get_secretkeys()

n = p * q
m = bytes_to_long(flag)
e = 0x10001
ct = pow(m,e,n)

print(f'ra = {ra}')
print(f'rb = {rb}')
print(f'len_p = {len_p}')
print(f'len_q = {len_q}')
print(f'n = {n}')
print(f'ct = {ct}')

'''
ra = 8607
rb = 7150
len_p = 1024
len_q = 1024
n = 28098722633030488893312283528887829649553659514053781575839443778746567710358683558509768930786261053897116586758341172713231425712608663734433267335002333760261583976848753337338129716792124202066388265994360580739266657504481707827816610267011366001142300093926601793983384666604377328323493638248481764153911921310476848622133065363121266256704484624454408157373499690818152144645904269865423396689289703578108901228755055729490144039004436875090060394642072739901593627031008002995026214521011417826487454434739123729500727953687489123493596702814564384266479646307886530097993679086392267067430262508230063492593
ct = 1361368491194202361715607865372797868849909740139730895054740999951755977992724940480130958163781061991384502597774968578284702191375825258332749459177999721414531960173967638050842294432428891589365478524879091438660354502169037756949918455465931069407443747905678846811248473459896942787043705093661155283970943862884656259675846526304020149516360300122739147864690004414833366319773397061007864065322841302908571648122903295064833926287970664637537668175501504866705196230324464962122113398544393881450146243000410853975781504185685414280739943390199620950135398253008721600717727922668728798959184802994979420495
'''